# Test for persisting messages to disk on shutdown
# rgerhards, 2009-04-17
$ModLoad ../plugins/imtcp/.libs/imtcp
$MainMsgQueueTimeoutShutdown 1
$MainMsgQueueSaveOnShutdown on
$InputTCPServerRun 13514

$ModLoad ../plugins/imdiag/.libs/imdiag
$IMDiagServerRun 13500

$ModLoad ../plugins/omtesting/.libs/omtesting

$ErrorMessagesToStderr off

# set spool locations and switch queue to disk-only mode
$WorkDirectory test-spool
$MainMsgQueueFilename mainq
$MainMsgQueueType LinkedList

$template outfmt,"%msg:F,58:2%\n"
$template dynfile,"rsyslog.out.log" # trick to use relative path names!
:msg, contains, "msgnum:" ?dynfile;outfmt

# delay execution so that a queue can build up:
*.*	:omtesting:sleep 0 1000
